<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hanzi Vocab Â· 11â€“20 Â· åˆ—è¡¨+ç¬”é¡ºï¼ˆæµ…é»„çº¸ï¼‰</title>
  <style>
    :root{
      --paper:#FAF4DF;      /* æµ…é»„è‰²è‡ªç„¶çº¸ */
      --ink:#181818;        /* é»‘å­— */
      --muted:#5e5e5e;      /* æ¬¡çº§æ–‡å­— */
      --line:#d9cfb4;       /* çº¸çº¹çº¿æ¡ */
      --card:#fffaf0;       /* çº¸å¡ç‰‡ */
      --accent:#3a74d7;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--paper);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,
        "PingFang SC","Hiragino Sans GB","Microsoft YaHei","Source Han Sans SC",sans-serif;}
    /* çº¸å¼ çº¹ç†ï¼ˆçº¯CSSï¼‰ */
    body{
      background-image:
        radial-gradient(rgba(0,0,0,0.035) 1px, transparent 1px),
        repeating-linear-gradient(0deg, rgba(0,0,0,0.02), rgba(0,0,0,0.02) 1px, transparent 1px, transparent 12px);
      background-size: 3px 3px, 100% 14px;
    }
    a{color:var(--accent)}
    header{position:sticky;top:0;z-index:10;background:rgba(250,244,223,.92);
      backdrop-filter: blur(6px); border-bottom:1px solid var(--line)}
    .wrap{max-width:1000px;margin:0 auto;padding:14px}
    h1{margin:0 0 8px;font-size:20px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px;
      box-shadow: 0 2px 0 rgba(0,0,0,.03), 0 12px 24px rgba(0,0,0,.04)}
    label{font-size:14px;color:var(--muted)}
    input[type="text"],select{background:#fff;border:1px solid #d8d0bb;color:var(--ink);
      padding:8px 10px;border-radius:10px;outline:none}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #d8d0bb;cursor:pointer;background:#fff}
    .pill.active{background:#2f6adf;color:#fff;border-color:#2f6adf}
    button{appearance:none;border:1px solid #d8d0bb;background:#fff;color:var(--ink);
      padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    button:hover{border-color:#c3b796}
    .muted{color:var(--muted);font-size:13px}
    .grid{display:grid;gap:10px}
    @media(min-width:900px){ .grid-2{grid-template-columns: 1.2fr .8fr} }
    .hidden{display:none}
    /* List */
    .list{display:grid;gap:8px}
    .item{display:grid;grid-template-columns: 56px 1fr;gap:10px;align-items:center;
      background:#fff;border:1px solid #e4dcc7;border-radius:12px;padding:8px 10px;cursor:pointer}
    .item:hover{background:#fff7df}
    .idx{color:#7a715d;font-size:12px;text-align:center}
    .hanzi{font-size:26px;line-height:1.2;color:var(--ink);
      font-family:"Kaiti SC","STKaiti","KaiTi","DFKai-SB","BiauKai","Songti SC","Noto Serif CJK SC",serif;}
    .pin{color:#9e5d00;font-size:14px}
    .eng{color:#6c6c6c;font-size:13px}
    /* Viewer */
    .viewer{position:sticky;top:74px}
    .word-title{font-size:28px;margin:0 0 6px;color:var(--ink);
      font-family:"Kaiti SC","STKaiti","KaiTi","DFKai-SB","BiauKai","Songti SC","Noto Serif CJK SC",serif;}
    .boxwrap{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px}
    .charbox{background:#fff;border:1px solid #e6dcc5;border-radius:10px;padding:8px;position:relative}
    .playbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .tag{display:inline-block;font-size:12px;color:#5b5b5b;border:1px solid #d8d0bb;padding:2px 6px;border-radius:8px;background:#fff}
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#fff;
      border:1px solid #d8d0bb;color:var(--ink);padding:8px 12px;border-radius:10px;z-index:9999;
      box-shadow:0 10px 18px rgba(0,0,0,.06)}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Hanzi Vocab Â· 11â€“20 Â· åˆ—è¡¨+ç¬”é¡º</h1>
    <div class="row" style="gap:12px">
      <div class="card" style="flex:1 1 320px">
        <div class="row">
          <label for="tpl">JSON è·¯å¾„æ¨¡æ¿</label>
          <input id="tpl" type="text" value="./lesson##.json" style="flex:1" />
        </div>
      </div>
      <div class="card" style="flex:1 1 260px">
        <div class="row" style="align-items:center;gap:8px">
          <label>è¯¾ç¨‹</label>
          <select id="lessonSel"></select>
          <div class="pill" id="reloadBtn">é‡æ–°åŠ è½½</div>
          <div class="muted" style="margin-left:auto">å­—å½¢ï¼š</div>
          <div id="scriptBar" class="row" style="gap:6px">
            <span class="pill" data-script="simp">ç®€ä½“</span>
            <span class="pill" data-script="trad">ç¹é«”</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="wrap grid grid-2">
  <section class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="muted"></div>
      <div class="row">
        <input id="search" type="text" placeholder="æœç´¢ï¼ˆæ±‰å­—/æ‹¼éŸ³/è‹±æ–‡ï¼‰" />
      </div>
    </div>
    <div id="list" class="list" style="margin-top:10px"></div>
  </section>

  <aside class="card viewer">
    <div id="viewerEmpty" class="muted">ğŸ‘ˆ é€‰æ‹©ä¸€ä¸ªè¯æŸ¥çœ‹ç¬”é¡º</div>
    <div id="viewer" class="hidden">
      <div class="row" style="justify-content:space-between">
        <div>
          <h2 id="wordTitle" class="word-title">â€”â€”</h2>
          <div class="pin" id="wordPin"></div>
          <div class="eng" id="wordEng"></div>
          <div class="row" style="gap:8px;margin-top:6px">
            <span class="tag" id="tagScript"></span>
            <span class="tag" id="tagLesson"></span>
          </div>
        </div>
        <div class="playbar">
          <button id="playAll">æ’­æ”¾</button>
          <button id="replay">é‡æ’­</button>
        </div>
      </div>
      <div id="boxwrap" class="boxwrap" style="margin-top:10px"></div>
      <div id="cdnWarn" class="muted hidden" style="margin-top:8px;color:#9b2c2c">
        âš ï¸ æœªèƒ½åŠ è½½ç¬”é¡ºåº“ï¼ˆHanzi Writerï¼‰ã€‚è¯·æ›´æ¢ç½‘ç»œï¼Œæˆ–æŠŠ <code>hanzi-writer.min.js</code> æ”¾åˆ°ä»“åº“æ ¹ç›®å½•ï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰ã€‚
      </div>
    </div>
  </aside>
</main>

<footer class="wrap" style="padding:22px 14px 40px">
  <div class="muted">Â© Hanzi Â· Lessons 11â€“20 Â· æµ…é»„çº¸ + é»‘å­— + æ¥·ä½“ã€‚ç¬”é¡ºåŸºäº Hanzi Writerã€‚</div>
</footer>

<script>
  // ----- åŠ¨æ€åŠ è½½ Hanzi Writerï¼ˆ3 ä¸ª CDN + æœ¬åœ°å…œåº•ï¼‰ -----
  function loadScript(src){return new Promise((res,rej)=>{const s=document.createElement('script');s.src=src;s.onload=res;s.onerror=rej;document.head.appendChild(s);});}
  async function ensureHW(){
    const srcs=[
      'https://unpkg.com/hanzi-writer@2.1.2/dist/hanzi-writer.min.js',
      'https://cdn.jsdelivr.net/npm/hanzi-writer@2.1.2/dist/hanzi-writer.min.js',
      'https://cdnjs.cloudflare.com/ajax/libs/hanzi-writer/2.1.2/hanzi-writer.min.js',
      './hanzi-writer.min.js' // å¯é€‰ï¼šä½ æŠŠåº“æ”¾åˆ°ä»“åº“æ ¹ç›®å½•å³å¯ç¦»çº¿ä½¿ç”¨
    ];
    for(const s of srcs){
      try{ await loadScript(s); if(window.HanziWriter){ console.log('HW loaded from', s); return true; } }catch(e){}
    }
    return false;
  }
  (async ()=>{
    const ok = await ensureHW();
    if(!ok) window.__HW_FAIL__=true;
    initApp();
  })();
</script>

<script>
  // ---------- Preferences ----------
  const getScript = () => localStorage.getItem('scriptPref') || 'simp';
  const setScript = (v) => (localStorage.setItem('scriptPref', v), paintScriptBar(), refreshList());
  function paintScriptBar(){
    document.querySelectorAll('#scriptBar .pill').forEach(p=>{
      p.classList.toggle('active', p.dataset.script===getScript());
    });
  }
  document.addEventListener('click',(e)=>{
    const pill=e.target.closest('#scriptBar .pill'); if(!pill) return;
    setScript(pill.dataset.script);
  });

  // ---------- Lesson select 11â€“20 ----------
  const lessonSel = document.getElementById('lessonSel');
  for(let n=11;n<=20;n++){
    const opt=document.createElement('option');
    opt.value=String(n);
    opt.textContent='ç¬¬ '+n+' è¯¾';
    lessonSel.appendChild(opt);
  }
  lessonSel.value='11';
  lessonSel.addEventListener('change', ()=> loadLesson());
  document.getElementById('reloadBtn').onclick = ()=> loadLesson();

  // ---------- App init ----------
  function initApp(){
    paintScriptBar();
    loadLesson();
  }

  // ---------- Data ----------
  let curLesson = 11;
  let entries = [];
  async function loadLesson(){
    curLesson = Number(lessonSel.value);
    const tpl = (document.getElementById('tpl').value||'./lesson##.json').trim();
    const path = tpl.replace('##', String(curLesson).padStart(2,'0')).replace('#', String(curLesson));
    try{
      const res = await fetch(path);
      if(!res.ok) throw new Error('åŠ è½½å¤±è´¥ï¼š'+path);
      const js = await res.json();
      entries = js.entries || [];
      refreshList();
      toast('å·²åŠ è½½ç¬¬ '+curLesson+' è¯¾ï¼Œå…± '+entries.length+' æ¡');
    }catch(err){
      console.error(err);
      entries = [];
      refreshList();
      toast('âš ï¸ '+err.message);
    }
  }

  function refreshList(){
    const list = document.getElementById('list');
    const q = (document.getElementById('search').value||'').trim().toLowerCase();
    list.innerHTML='';
    const useTrad = getScript()==='trad';
    const filtered = entries.filter(e=>{
      const hz = useTrad ? (e.trad||e.simp||'') : (e.simp||e.trad||'');
      const pin=(e.pinyin||'').toLowerCase();
      const eng=(e.english||'').toLowerCase();
      return !q || hz.includes(q) || pin.includes(q) || eng.includes(q);
    });
    filtered.forEach((e,i)=>{
      const hz = useTrad ? (e.trad||e.simp||'') : (e.simp||e.trad||'');
      const row = document.createElement('div');
      row.className='item';
      row.innerHTML = `
        <div class="idx">${String(i+1).padStart(2,'0')}</div>
        <div>
          <div class="hanzi">${hz}</div>
          <div class="pin">${e.pinyin||''}</div>
          <div class="eng">${e.english||''}</div>
        </div>`;
      row.addEventListener('click', ()=> showStroke(e));
      list.appendChild(row);
    });
    if(!filtered.length){
      list.innerHTML = '<div class="muted">æ²¡æœ‰åŒ¹é…çš„æ¡ç›®ã€‚</div>';
    }
  }

  document.getElementById('search').addEventListener('input', refreshList);

  // ---------- Stroke viewer ----------
  let writers = [];
  function clearViewer(){
    writers.forEach(w=> w && w.hideCharacter && w.hideCharacter());
    writers = [];
    document.getElementById('boxwrap').innerHTML='';
  }
  function showStroke(entry){
    const useTrad = getScript()==='trad';
    const word = useTrad ? (entry.trad||entry.simp||'') : (entry.simp||entry.trad||'');
    document.getElementById('viewerEmpty').style.display='none';
    document.getElementById('viewer').classList.remove('hidden');
    document.getElementById('wordTitle').textContent = word;
    document.getElementById('wordPin').textContent = entry.pinyin||'';
    document.getElementById('wordEng').textContent = entry.english||'';
    document.getElementById('tagScript').textContent = useTrad?'ç¹é«”':'ç®€ä½“';
    document.getElementById('tagLesson').textContent = 'ç¬¬ '+curLesson+' è¯¾';
    clearViewer();

    const boxwrap = document.getElementById('boxwrap');
    const chars = Array.from(word).filter(c => /[\u3400-\u9fff]/.test(c)); // CJK only
    if(!chars.length){
      boxwrap.innerHTML = '<div class="muted">è¯¥è¯æ²¡æœ‰å¯å±•ç¤ºçš„æ±‰å­—ã€‚</div>';
      return;
    }
    // å¦‚æœåº“æ²¡åŠ è½½æˆåŠŸï¼Œç»™å‡ºæç¤º
    if(window.__HW_FAIL__ || !window.HanziWriter){
      document.getElementById('cdnWarn').classList.remove('hidden');
      boxwrap.innerHTML = '<div class="muted">æ— æ³•åŠ è½½ç¬”é¡ºåŠ¨ç”»åº“ã€‚</div>';
      return;
    } else {
      document.getElementById('cdnWarn').classList.add('hidden');
    }
    // Create boxes and writers
    chars.forEach((ch, idx)=>{
      const d = document.createElement('div');
      d.className='charbox';
      d.innerHTML = `<div id="char_${idx}" style="width:100%;height:100px"></div>`;
      boxwrap.appendChild(d);
      const w = HanziWriter.create(`char_${idx}`, ch, {
        width: 100, height: 100, padding: 5, showCharacter: true, showOutline: true,
        strokeAnimationSpeed: 1, delayBetweenStrokes: 150
      });
      writers.push(w);
    });

    // è‡ªåŠ¨æ’­æ”¾ä¸€æ¬¡
    (async ()=>{ for(const w of writers){ await w.animateCharacter(); } })();

    // æŒ‰é’®æ§åˆ¶
    document.getElementById('playAll').onclick = async ()=>{
      for(const w of writers){ await w.animateCharacter(); }
    };
    document.getElementById('replay').onclick = async ()=>{
      for(const w of writers){ w.hideCharacter(); await w.animateCharacter(); }
    };
  }

  // ---------- utils ----------
  function toast(msg){
    const el=document.createElement('div'); el.className='toast'; el.textContent=msg;
    document.body.appendChild(el); setTimeout(()=> el.remove(), 2400);
  }
</script>
</body>
</html>
